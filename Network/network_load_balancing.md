### 로드 밸런싱

#### Load Balancer

* 로드 밸런서란 일반적으로 서버의 부하를 분산 해주는 장치 또는 기술을 뜻한다.

* 보통은 서버 상단 네트워크에 위치하고 있으며, 서버 한대에 트래픽이 집중되지 않도록 트래픽을 관리하여 각 서버가 최적의 효율을 발휘할 수 있게 해주는 역할을 수행한다.

![image](https://github.com/user-attachments/assets/cc2ad198-adb0-4173-bccb-dc5e16c97e6e)

* Client가 Sever에게 어떠한 `요청`을 하게되면 loadBalancer에서 해당 요청을 받아들여서 비교적 한가한 서버에게 트래픽을 분산하여 과부화를 방지하는 역할이다.

* 서버에 부하를 분산하는 것 뿐만 아니라 트래픽 자체도 분산하기 위해 사용되지만 요즘은 SLB(Server Load Balancing)이 주를 이루고 있다.

#### Load Balancer 기본기능

##### Health Check

* 서버가 정상적으로 작동하는지 주기적으로 확인하는 기능을 말한다. 비정상적인 서버를 트래픽 분배 대상에서 제외시킴으로써 서비스의 가용성과 안정성을 높인다.

**1-1 ICMP**
* VIP에 연결된 리얼 서버에 대해 ICMP(ping)로 헬스 체크를 수행하는 방법입니다. 단순히 서버가 살아 있는지 여부만 체크할 수 있으므로 자주 사용하지는 않는다.

* 서버의 생존 여부는 확인할 수 있지만, 애플리케이션 레벨의 상태는 알 수 없다.

* 애플리케이션 레벨에서 Health Check를 하기 위해선 데이터베이스 쿼리를 통해 데이터베이스 상태를 확인하거나, 애플리케이션 내부의 특정 모듈이 정상적으로 작동하는지
확인하는 API End Point를 호출하는 방법이 있다.

이러한 방법을 사용하면 애플리케이션의 구체적인 상태를 점검할 수 있으며, 문제가 발생한 지점을 보다 정확히 파악할 수 있다.

**1-2 TCP HandShake**

* 가장 기본적인 헬스 체크 방법은 로드 밸런서에 설정된 서버의 서비스 포트를 확인하는 것이다.

* 데이터 베이스 서버나 특정 포트에서 서비스 중인 애플리케이션 서버의 가용성을 확인하는 데 사용되고, 포트가 열려 있는지, 서버가 수신 대기 상태인지를 빠르게 확인 할 수 있음

##### Health Check의 구성요소

* 주기 (Interval) : 헬스 체크를 수행하는 주기이다. 주기가 짧은 수록 서버 상태를 빨리 감지할 수 있지만, 서버에 대한 Overhead 증가할 수 있다.

* 타임아웃(Timeout) : 헬스 체크 요청에 대한 응답을 기다리는 최대 시간을 말한다. 타임아웃을 초과하면 해당 헬스 체크는 실패로 간주 된다.

* 재시도 횟수(Retry Attempts) : 서버가 일시적으로 응답하지 않을 경우를 대비하여, 헬스 체크를 재시도하는 횟수이다. 일반적으로는 여러 번 실패한 후에 서버를 비정상으로 간주한다.

* 임계값(Thresholds) : 서버를 비정상 또는 정상으로 간주하기 위한 헬스 체크 성공 및 실패 횟수 기준을 말한다. 예를 들어 3번 연속 실패시 server is 비정상...

##### Health Check의 중요성

* 서버가 정상적으로 작동하는지 확인하기 때문에 안정적인 서비스를 제공하는 것에 기여할 수 있고,  서버의 장애를 신속하게 감지하고 문제를 해결할 수 있도록 도움을 준다.

* HeathCheck 를 통해 자동화된 장애 복구 프로세스를 트리거하여 서버가 정상 상태로 돌아오면 자동으로 트래픽을 다시 분배한다.


##### Load Balancing Algorithm 

**1. Least Connection 알고리즘**

* 한글로 풀어쓰면 `최소 연결` 알고리즘이다. 말 그대로 가장 적게 연결 되어 있는 서버에 세션을 할당해주는 방식을 말한다

* 서버에 분배된 세션들이 일정하지 않은 경우에 적합하며, 부하를 줄이는 측면에서 많이 사용된다.

**2.Round Robin 알고리즘**

* 순차적으로 돌아가며 세션을 할당해주는 방식을 말한다. 요청이 오면 단순히 그 요청을 순서대로 서버에 분배해주는데, 첫 번째 요청은 미리 등록된 첫 번째 서버
두번째 요청은 두 번째 서버에 할당해준다.

* 로드밸런싱 대상 서버의 스펙이 동일하고, 처리시간 혹은 세션지속시간이 짧은 애플리케이션의 경우 이러한 방식이 적합하다.

**3.Hash 알고리즘**

* 특정 사용자는 특성 서버로만 할당시키는 방식을 말한다. 이외에도 특정한 기준을 잡아 특정 서버에 매핑하여 고정적으로 트래픽을 분산해주는 방식을 말한다.

* 일반적으로는 출발지 (Client)의 IP가 그 기준이 되고, 특정 IP주소나 포트를 갖는 사용자들은 특정 서버로만 세션을 맺도록 하여 특정 IP주소나 포트에서 접속량이 특히 많을 때 관리가 편한 방식이다.

  
