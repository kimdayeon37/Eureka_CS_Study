# 브라우저 저장소
브라우저 저장소에는 **쿠키**와 HTML5부터 제공하는 **웹 스토리지**가 있습니다.
웹 스토리지와 쿠키 모두 해당 도메인에 대한 데이터를 브라우저에 저장합니다.

> #### 배경
브라우저 저장소에 대한 배경에는 서버와 클라이언트가 서로 소통할 때 지켜야하는 규약인 HTTP가 **stateless** 하다는 특징에 있습니다.

HTTP는 먼저 클라이언트가 서버에게 request를 보내고, 서버는 클라이언트에게 request에 대한 response를 보내고 접속을 종료합니다. 접속이 종료되면 상태 정보가 유지되지 않는다는 특징(stateless)이 있습니다.
<img width="365" alt="image" src="https://github.com/user-attachments/assets/6891f322-f01c-44e6-a465-f02ab51615e0">

따라서 로그인을 한다라고 생각했을 때 클라이언트가 인증에 쓰이는 상태 정보가 저장되지 않고 매번 인증을 해줘야 합니다.

계속해서 통신 연결을 하지 않기 때문에 자원 낭비가 줄어드는 것은 장점이지만, 통신을 할 때마다 새로 연결을 해줘야 된다는 점에서 클라이언트는 불편하겠죠?

그래서 로그인을 할 때 정보를 어딘가에 저장해두면 문제를 쉽게 해결할 수가 있습니다.

그 때 사용하는 것이 바로 브라우저의 스토리지입니다.

---

## 쿠키 (Cookie)
쿠키는 서버가 클라이언트에게 전송하는 작은 데이터 파일입니다.

사이트에 방문하면 브라우저는 서버에 요청을 보냅니다. 서버는 이에 응답할텐데 응답에는 모든 데이터와 페이지 정보가 들어있을 겁니다. 그 과정에서 브라우저에 저장하고자 하는 쿠키 데이터가 있을 수도 있습니다. 

브라우저에 쿠키를 저장한 후에 해당 웹사이트를 방문할 때마다 해당 브라우저는 쿠키도 요청과 함께 보내지게 됩니다. 
쿠키에는 도메인에 따라 제한이 되어 경로정보와 서버에서 지정한 만료일자, 시간 등의 정보가 담겨있습니다.
![image](https://github.com/user-attachments/assets/f619bbaf-caec-418d-b6a2-fa57be2d42c2)

쿠키는 웹사이트에 방문한 사용자 정보를 사용자의 하드 디스크에 저장하게 됩니다. 클라이언트에서도 읽을 수 있지만 보통 서버 사이드에서 읽는 데이터입니다.

모든 브라우저에서 지원을 하지만 매번 서버에 전송이 되고 저장 용량이 작고 보안에 취약하다는 단점이 있습니다.

ex) 
- 언어 설정
- 이벤트 팝업창
- 서비스 약관
- 오늘 그만보기 등

---

## 웹 스토리지
HTML5부터는 쿠키의 단점을 보완한 웹 스토리지를 주로 사용합니다. 

쿠키와 기능은 유사하지만 클라이언트에 저장만 하고 서버에 전송되진 않습니다.

키(key)와 값(value)의 형태로 데이터를 저장합니다.

지속성에 따라 로컬 스토리지와 세션 스토리지로 구분합니다.

### 로컬 스토리지

브라우저 자체에 반영구적으로 데이터를 저장하고 브라우저를 종료해도 데이터가 유지됩니다.

ex) 자동 로그인 기능 

### 세션 스토리지

세션 스토리지는 탭 윈도우 단위로 생성이 되고 탭 윈도우를 닫을 때 데이터가 삭제됩니다.

ex) 입력 폼 정보, 비로그인 장바구니 기능


세션으로 로그인 할 때 프로세스를 살펴봅시다.
![image](https://github.com/user-attachments/assets/f8aa6aac-015e-4c7d-83ea-7b4a6d0b7a6a)

>stateless한 브라우저에서 매번 아이디와 비밀번호를 서버에 요청 
-> 유저와 비번이 맞다면 세션 DB에 유저를 생성 -> 해당 세션ID 생성 -> 해당 세션ID는 쿠키를 통해 브라우저로 돌아오고 저장

> 같은 웹사이트의 다른 페이지에서는 세션ID를 갖고있는 쿠키를 서버에 보냄 -> 서버는 들어오는 쿠키를 보고 세션ID와 함께 확인 -> 해당 세션ID를 가지고 세션DB에서 유저를 확인

해당 요청이 끝나고 다른 페이지로 이동하게 되면, 이 모든 프로세스가 반복됩니다.

중요한 사실은 모든 유저 정보는 서버에 있다는 것입니다. 현재 로그인한 유저들의 모든 세션ID를 DB에 저장하는 것이 특징입니다. 

하지만 매 요청마다 서버에서 유저를 찾기 때문에 유저가 늘어남에 따라 DB 리소스가 더 필요하다는 단점이 있습니다.

>#### 쿠키와 세션의 관계성
- 결국 유저가 갖고 있는 것은 세션ID일 뿐이고, 쿠키는 그저 세션ID를 전달하기 위한 매개체일 뿐

- 세션을 이용해서 iOS, 안드로이드 앱을 만들 수 있지만, 쿠키는 웹브라우저에만 있기 때문에 쿠키만으로는 만들 수 없습니다.

---

## JWT (JSON Web Tokens)
Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token으로 JWT는 토큰 형식입니다.

JWT는 stateless한 특성을 가집니다. 따라서 인증할 때 세션DB를 갖을 필요가 없고, 서버는 세션DB를 통해 유저 인증하는 단계를 거치지 않아도 됩니다.

> JWT 구조
![jwt](https://github.com/user-attachments/assets/f9f6bf74-fec6-4b6f-8827-8b4aa667daef)

1. Header (헤더)
2. Payload (페이로드)
3. Signature (서명)


header, payload, signature로 구성된 토큰을 서버 요청의 헤더 중 Authentication 속성에 넣어줍니다.

인증/인가에 대한 모든 정보가 하나의 토큰에 담겨있게 됩니다. 모든 정보가 담겨 있기 때문에 서버 입장에서는 인증/인가 혹은 사용자에 대한 정보를 저장할 필요 없이 인증/인가 관련된 정보를 추출하여 구현할 수가 있습니다.

즉, 서버는 유저를 인증하는데 필요한 정보를 토큰에 저장합니다. 페이지를 요청하면 **서버는 해당 토큰이 유효한지만 검증**하면 됩니다. 

JWT로 로그인 할 때 프로세스를 살펴봅시다.
![image](https://github.com/user-attachments/assets/35dd9097-f76c-4561-b429-055e9017e8ab)
> 유저ID와 비번이 맞다면, 유저ID를 가져가서 사인 알고리즘을 이용해서 ‘사인’ ->  해당 사인된 정보를 string 형태로 보냄.


> 서버에 요청을 보내려면, 해당 사인된 정보나 토큰을 서버에 보냄 -> 서버는 토큰을 받으면, 해당 토큰이 유효한지, 조작여부를 체크 -> 유효하다면 서버는 유저로 인증

JWT 방식을 활용하면 서버는 단지 토큰이 유효한지만 판단하면 되기 때문에 DB를 따로 살 필요가 없습니다.

### 세션과 JWT의 차이점

| Session                                     | JWT                                                      |
| ------------------------------------------- | -------------------------------------------------------- |
| 서버 메모리에 유저 정보 저장 O              | 서버 메모리에 유저 정보 저장 X                           |
| 요청 시 해당 정보를 조회해서 인증,인가 수행 | 요청 시 헤더에 있는 토큰을 파싱하여 인증, 인가 수행      |
| 서버 자원을 사용하므로, 서버 과부화에 취약  | 모든 인증/인가 관련 데이터가 전달되므로 요청/응답 무거움 |
| 단일 서버인 경우 효율적                     | 서버 확장성 관점에서 세션보다 유리                       |
| HTTP 프로토콜의 Stateless 특성 무효화       | HTTP 프로토콜의 Stateless 특성 만족                      |


세션에서는 유저 관리 기능에 대한 것들을 유용하게 처리할 수 있습니다. 세션은 대한 모든 정보는 DB에 저장되어 있어 페이지를 요청하면 서버는 세션ID를 DB에서 찾으면 되는 형식입니다. 모든 유저의 정보를 저장하기 때문에 정보에 대한 새로운 기능을 추가할 수 있게 됩니다.
- 특정 유저에 대한 관리가 가능 
- 인스타에서 로그인된 모든 디바이스를 보여주는데 원하지 않는 디바이스에서 강제 로그아웃하는 기능
- 넷플릭스에서 계정 공유 숫자를 제한하는 기능 (현재 로그인 유저, 시청 유저 등을 알 수 있음)
  
JWT는 위와 같은 유저 관리 기능에 대한 것은 할 수 없습니다. 세션을 관리하지 않고 유효성 검증으로 인증 상태를 유지하기 때문에 해당 토큰이 만료되기 전까지만 유효합니다.
- 유효시간이 있는 QR 코드


<aside>
💡 서비스가 커지고, 유저 계정을 좀 더 관리하고 싶다면 세션 관리가 더 좋을 것입니다.
</aside>
